generator client {
   provider = "prisma-client-js"
}

datasource db {
   provider = "postgresql"
   url      = env("DATABASE_URL")
}

enum UserRole {
   GUEST
   REALTOR
   ADMIN
}

enum PropertyType {
   APARTMENT
   HOUSE
   VILLA
   STUDIO
   TOWNHOUSE
   OTHER
}

enum BookingStatus {
   PENDING
   CONFIRMED
   CANCELLED
   COMPLETED
}

enum PaymentStatus {
   PENDING
   COMPLETED
   FAILED
   REFUNDED
}

enum PaymentMethod {
   PAYSTACK
   FLUTTERWAVE
}

enum RealtorStatus {
   PENDING
   APPROVED
   REJECTED
}

model User {
   id              String   @id @default(cuid())
   email           String   @unique
   businessEmail   String? // For realtors - their business email
   password        String
   fullName        String // Store full name as provided in registration
   firstName       String // Derived from fullName for backward compatibility
   lastName        String // Derived from fullName for backward compatibility
   role            UserRole @default(GUEST)
   phone           String?
   businessAddress String? // For realtors - their business address
   avatar          String?

   // Email verification fields
   isEmailVerified          Boolean   @default(false)
   emailVerificationToken   String?
   emailVerificationExpires DateTime?

   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt

   // Relations
   realtor  Realtor?
   bookings Booking[]
   reviews  Review[]
   payments Payment[]

   @@map("users")
}

model Realtor {
   id                 String        @id @default(cuid())
   userId             String        @unique
   businessName       String // Agency name from registration
   tagline            String? // Business tagline/description
   description        String? // Business description (optional)
   slug               String        @unique // Custom subdomain
   corporateRegNumber String? // Business registration number (CAC)
   cacDocumentUrl     String? // CAC Document upload URL (optional)
   logoUrl            String? // Logo upload URL
   businessPhone      String? // Business phone number
   status             RealtorStatus @default(PENDING) // Approval status

   // Branding colors from registration
   primaryColor   String  @default("#000000") // Default to black as per requirements
   secondaryColor String? @default("#10B981")
   accentColor    String? @default("#F59E0B")

   // Social media profiles from registration
   websiteUrl   String?
   instagramUrl String?
   twitterUrl   String?
   linkedinUrl  String?
   facebookUrl  String?
   youtubeUrl   String?
   whatsappType String? @default("business") // "personal" or "business"

   isActive  Boolean  @default(true)
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt

   // Relations
   user       User       @relation(fields: [userId], references: [id], onDelete: Cascade)
   properties Property[]

   @@map("realtors")
}

model Property {
   id            String       @id @default(cuid())
   realtorId     String
   title         String
   description   String
   type          PropertyType
   pricePerNight Decimal      @db.Decimal(10, 2)
   currency      String       @default("NGN")
   maxGuests     Int
   bedrooms      Int
   bathrooms     Int
   address       String
   city          String
   country       String
   isActive      Boolean      @default(true)
   createdAt     DateTime     @default(now())
   updatedAt     DateTime     @updatedAt

   // Relations
   realtor  Realtor         @relation(fields: [realtorId], references: [id], onDelete: Cascade)
   bookings Booking[]
   reviews  Review[]
   images   PropertyImage[]

   @@map("properties")
}

model PropertyImage {
   id         String @id @default(cuid())
   propertyId String
   url        String
   order      Int    @default(0)

   property Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

   @@map("property_images")
}

model Booking {
   id           String        @id @default(cuid())
   propertyId   String
   guestId      String
   checkInDate  DateTime
   checkOutDate DateTime
   totalGuests  Int
   totalPrice   Decimal       @db.Decimal(10, 2)
   currency     String        @default("NGN")
   status       BookingStatus @default(PENDING)
   createdAt    DateTime      @default(now())
   updatedAt    DateTime      @updatedAt

   // Relations
   property Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
   guest    User     @relation(fields: [guestId], references: [id], onDelete: Cascade)
   payment  Payment?
   review   Review?

   @@map("bookings")
}

model Payment {
   id        String        @id @default(cuid())
   bookingId String        @unique
   userId    String
   amount    Decimal       @db.Decimal(10, 2)
   currency  String        @default("NGN")
   status    PaymentStatus @default(PENDING)
   method    PaymentMethod
   reference String? // paystack/flutterwave ref
   createdAt DateTime      @default(now())
   updatedAt DateTime      @updatedAt

   // Relations
   booking Booking @relation(fields: [bookingId], references: [id], onDelete: Cascade)
   user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)

   @@map("payments")
}

model Review {
   id         String   @id @default(cuid())
   bookingId  String   @unique
   propertyId String
   authorId   String
   rating     Int
   comment    String?
   createdAt  DateTime @default(now())

   // Relations
   booking  Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)
   property Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
   author   User     @relation(fields: [authorId], references: [id], onDelete: Cascade)

   @@map("reviews")
}
